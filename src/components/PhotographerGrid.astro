---
import { getCollection } from 'astro:content';
import { Image } from 'astro:assets';

interface Photographer {
  name: string;
  link: string;
  birthYear: string;
  birthPlace: string;
  deathYear?: string;
  deathPlace?: string;
  camp: string;
}

// Fetch photographer entries from the collection
const photographerEntries = await getCollection('family-album', (entry) => {
  return entry.id.startsWith('photographers/') && !entry.id.includes('professional');
});

// Transform the entries into the format we need
const photographers = photographerEntries.map(entry => ({
  name: entry.data.name || entry.data.title,
  link: `/family-album/photographers/${entry.id.split('/')[1].replace('.mdx', '')}`,
  birthYear: entry.data.birthYear || 'Unknown',
  birthPlace: entry.data.birthPlace || 'Unknown',
  deathYear: entry.data.deathYear,
  deathPlace: entry.data.deathPlace,
  camp: entry.data.camp || 'Unknown'
}));

// Import all photographer banner images
const imageImports = {
  akiya: (await import('@/images/family-album/akiyaban.gif')).default,
  ayukawa: (await import('@/images/family-album/ayukawaban.gif')).default,
  fukuyama: (await import('@/images/family-album/fukuyamaban.gif')).default,
  miyatake: (await import('@/images/family-album/miyatakeban.gif')).default,
  morioka: (await import('@/images/family-album/moriokaban.gif')).default,
  nomura: (await import('@/images/family-album/nomuraban.gif')).default,
  tsuyuki: (await import('@/images/family-album/tsuyukiban.gif')).default
};
---

<div class="grid gap-8 md:grid-cols-2 lg:grid-cols-3">
  {photographers.map(photographer => {
    const photographerId = photographer.link.split('/').pop();
    const photographerImage = imageImports[photographerId];
    
    return (
      <a href={photographer.link} class="group">
        <article class="bg-white rounded-lg shadow-md overflow-hidden transition-transform duration-200 hover:scale-105">
          <div class="aspect-[4/3] overflow-hidden bg-gray-100">
            {photographerImage && (
              <Image
                src={photographerImage}
                alt={photographer.name}
                class="w-full h-full object-cover transition-transform duration-200 group-hover:scale-110"
                loading="lazy"
              />
            )}
          </div>
          <div class="p-4">
            <h3 class="text-lg font-bold mb-2">{photographer.name}</h3>
            <p class="text-sm text-gray-600">
              Born {photographer.birthYear}, {photographer.birthPlace}
              {photographer.deathYear && (
                <span>
                  <br />
                  Died {photographer.deathYear}, {photographer.deathPlace}
                </span>
              )}
            </p>
            <p class="text-sm text-gray-600 mt-2">
              Interned at {photographer.camp}
            </p>
          </div>
        </article>
      </a>
    );
  })}
</div>