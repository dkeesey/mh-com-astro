---
import FamilyAlbumLayout from "@layouts/FamilyAlbumLayout.astro";
import { Image } from 'astro:assets';
import FamilyAlbumIntro from "@components/FamilyAlbumIntro.astro";
import PhotographersGrid from "@components/PhotographersGrid.astro";
import ContrabandSection from "@components/ContrabandSection.astro";
import InterneePhotographerSection from "@components/InterneePhotographerSection.astro";
import AmateurPhotographerSection from "@components/AmateurPhotographerSection.astro";
import VisitorsSection from "@components/VisitorsSection.astro";
import CanadianIncarcerationSection from "@components/CanadianIncarcerationSection.astro";
import Breadcrumb from '@components/Breadcrumb.astro';
import ExhibitionInfo from '@components/ExhibitionInfo.astro';
import TableOfContents from '@components/TableOfContents.tsx';
import AudioPlayer from "@components/audio-player";
import installPic1 from '@images/family-album/installation/install-pic1.jpg';
import installPic3 from '@images/family-album/installation/install-pic3.jpg';

const sections = [
  { 
    id: 'introduction', 
    title: 'Introduction',
    description: 'Overview of the Family Album Project and its significance'
  },
  { 
    id: 'exhibition-views', 
    title: 'Exhibition Views',
    description: 'Visual documentation of the original exhibition'
  },
  { 
    id: 'contraband', 
    title: 'Contraband',
    description: 'How cameras became contraband items in the camps'
  },
  { 
    id: 'internee-photographers', 
    title: 'Internee Photographers',
    description: 'Stories of photographers within the camps'
  },
  { 
    id: 'amateur-photographers', 
    title: 'Amateur Photographers',
    description: 'Family photographs taken by internees'
  },
  { 
    id: 'visitors', 
    title: 'Visitors',
    description: 'Photographs taken by camp visitors'
  },
  { 
    id: 'canadian-incarceration', 
    title: 'Canadian Incarceration',
    description: 'The parallel experience in Canadian internment camps'
  },
  { 
    id: 'about', 
    title: 'About the Exhibition',
    description: 'Details about the original exhibition and its curation'
  }
];

const audioFiles = [
  {
    title: "Interview 1",
    src: "/audio/JACCampsMP3/camps.01.mp3",
    oggSrc: "/audio/JACCampsOgg/camps.01.ogg",
    excerpt: "All American Boy...",
  },
  {
    title: "Interview 2",
    src: "/audio/JACCampsMP3/camps.02.mp3",
    oggSrc: "/audio/JACCampsOgg/camps.02.ogg",
    excerpt: "Angry Man...",
  },
  {
    title: "Interview 3",
    src: "/audio/JACCampsMP3/camps.03.mp3",
    oggSrc: "/audio/JACCampsOgg/camps.03.ogg",
    excerpt: "What would you do if we deported you?",
  },
  {
    title: "Interview 4",
    src: "/audio/JACCampsMP3/camps.04.mp3",
    oggSrc: "/audio/JACCampsOgg/camps.04.ogg",
    excerpt: "Everyone just believed in the government...",
  },
  {
    title: "Interview 5",
    src: "/audio/JACCampsMP3/camps.05.mp3",
    oggSrc: "/audio/JACCampsOgg/camps.05.ogg",
    excerpt: "We are American citizens and had nothing to do with Pearl Harbor",
  },
  {
    title: "Interview 6",
    src: "/audio/JACCampsMP3/camps.06.mp3",
    oggSrc: "/audio/JACCampsOgg/camps.06.ogg",
    excerpt: "We were being treated like the enemy...",
  },
  {
    title: "Interview 7",
    src: "/audio/JACCampsMP3/camps.07.mp3",
    oggSrc: "/audio/JACCampsOgg/camps.07.ogg",
    excerpt: "No future for my children?...",
  },
  {
    title: "Interview 8",
    src: "/audio/JACCampsMP3/camps.08.mp3",
    oggSrc: "/audio/JACCampsOgg/camps.08.ogg",
    excerpt: "Rehabilitation",
  },
  {
    title: "Interview 9",
    src: "/audio/JACCampsMP3/camps.09.mp3",
    oggSrc: "/audio/JACCampsOgg/camps.09.ogg",
    excerpt: "If I can get through that...",
  },
];

---

<FamilyAlbumLayout title="Family Album Project" description="A collection of photographs and stories from Japanese American internment camps">
  <div class="relative">
    <main class="relative max-w-[100rem] mx-auto px-4 py-8">
      <div class="mb-8">
        <Breadcrumb
          items={[
            { label: "Home", href: "/" },
            { label: "Family Album Project", href: "/family-album-project", current: true }
          ]}
        />
        
        <div class="mt-8">
          <PhotographersGrid />
        </div>
      </div>

      <div class="lg:grid lg:grid-cols-[1fr_300px] lg:gap-8">
        <div class="space-y-16">
          <!-- Introduction -->
          <section id="introduction">
            <FamilyAlbumIntro />
          </section>

          <!-- Exhibition Images -->
          <section id="exhibition-views" class="mt-16">
            <h2 class="text-3xl font-light mb-8">Exhibition Views</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
              <div>
                <Image 
                  src={installPic1}
                  alt="Installation view of the Family Album Project"
                  class="w-full h-auto rounded-lg shadow-lg"
                />
                <p class="mt-2 text-sm text-gray-300 italic">Cleveland State University Art Gallery, March 1996, Installation View</p>
              </div>
              <div>
                <Image 
                  src={installPic3}
                  alt="Installation view: CONTRABAND: THE CAMERA, THE PHOTOGRAPH, THE FAMILY ALBUM"
                  class="w-full h-auto rounded-lg shadow-lg"
                />
                <p class="mt-2 text-sm text-gray-300 italic">Installation Detail: CONTRABAND: THE CAMERA, THE PHOTOGRAPH, THE FAMILY ALBUM</p>
              </div>
            </div>
          </section>

          <!-- Content Sections -->
          <section id="contraband" class="mt-16">
            <ContrabandSection />
          </section>
          <section id="internee-photographers" class="mt-16">
            <InterneePhotographerSection />
          </section>
          <section id="amateur-photographers" class="mt-16">
            <AmateurPhotographerSection />
          </section>
          <section id="visitors" class="mt-16">
            <VisitorsSection />
          </section>
          <section id="canadian-incarceration" class="mt-16">
            <CanadianIncarcerationSection />
          </section>

          <!-- About Exhibition -->
          <section id="about" class="mt-16">
            <ExhibitionInfo />
          </section>
        </div>

        <div class="hidden lg:block space-y-8">
          <div class="sticky top-24">
            <div class="mb-8">
              <AudioPlayer
                audioFiles={audioFiles.map(file => ({ 
                  title: file.title,
                  url: file.src,
                  excerpt: file.excerpt 
                }))}
                variant="compact"
                className="w-full bg-card rounded-lg shadow-sm mb-6"
                showTranscript={false}
                showTimeline={false}
                client:load
              />
            </div>
            <TableOfContents sections={sections} client:load />
          </div>
        </div>
      </div>

      {/* Mobile Audio Player */}
      <div class="lg:hidden">
        <AudioPlayer
          audioFiles={audioFiles.map(file => ({ 
            title: file.title,
            url: file.src,
            excerpt: file.excerpt 
          }))}
          variant="compact"
          showTranscript={false}
          showTimeline={false}
          client:load
        />
      </div>
    </main>

    {/* Back to Top Button */}
    <button
      id="backToTop"
      class="fixed bottom-4 right-4 bg-gray-800 text-white p-3 rounded-full shadow-lg opacity-0 transition-opacity duration-300 hover:bg-gray-700 z-50"
      aria-label="Back to top"
    >
      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18" />
      </svg>
    </button>
  </div>
</FamilyAlbumLayout>

<script>
  // Back to Top Button Functionality
  const backToTopButton = document.getElementById('backToTop');
  
  if (backToTopButton) {
    window.addEventListener('scroll', () => {
      if (window.scrollY > 500) {
        backToTopButton.style.opacity = '1';
      } else {
        backToTopButton.style.opacity = '0';
      }
    });

    backToTopButton.addEventListener('click', () => {
      window.scrollTo({
        top: 0,
        behavior: 'smooth'
      });
    });
  }

  // Add smooth scrolling to all anchor links
  document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', (e: Event) => {
      e.preventDefault();
      const href = (e.currentTarget as HTMLAnchorElement).getAttribute('href');
      if (!href || href === '#') return;
      
      const target = document.querySelector<HTMLElement>(href);
      if (target) {
        target.scrollIntoView({
          behavior: 'smooth',
          block: 'start'
        });
        
        // Update URL without jumping
        history.pushState(null, '', href);
      }
    });
  });
</script>
