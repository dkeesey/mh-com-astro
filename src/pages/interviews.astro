---
import { ViewTransitions } from "astro:transitions";
import Layout from "@layouts/Layout.astro";
import { interviewAudioFiles } from "../data/interview-audio";
import AudioPlayer from "@components/audio-player";
---

<Layout title="Oral History Project Interviews">
  <div class="container mx-auto px-4 py-8">
    <h1 class="text-4xl font-bold mb-8">Oral History Project Interviews</h1>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
      {
        interviewAudioFiles.map((audio, index) => (
          <div class="bg-gray-800 rounded-lg p-6 shadow-lg">
            <h2 class="text-xl font-semibold text-white mb-2">{audio.title}</h2>
            <p class="text-gray-400 mb-4">{audio.excerpt}</p>
            {audio.timestamp && (
              <p class="text-sm text-gray-500">{audio.timestamp}</p>
            )}
            <audio
              src={audio.url}
              controls
              class="w-full mt-4"
              data-track-index={index}
            />
          </div>
        ))
      }
    </div>
  </div>
</Layout>

<style>
  audio {
    width: 100%;
    height: 40px;
    margin-top: 1rem;
  }

  audio::-webkit-media-controls-panel {
    background-color: transparent;
  }

  audio::-webkit-media-controls-play-button,
  audio::-webkit-media-controls-mute-button {
    background-color: transparent;
    color: white;
  }

  audio::-webkit-media-controls-current-time-display,
  audio::-webkit-media-controls-time-remaining-display {
    color: white;
  }

  audio::-webkit-media-controls-timeline {
    background-color: rgba(255, 255, 255, 0.2);
    border-radius: 25px;
    margin-left: 10px;
    margin-right: 10px;
  }
</style>

<script define:vars={{ interviewAudioFiles }}>
  // Stop all other audio players when one starts playing
  document.querySelectorAll('audio').forEach(audio => {
    audio.addEventListener('play', () => {
      document.querySelectorAll('audio').forEach(otherAudio => {
        if (otherAudio !== audio) {
          otherAudio.pause();
        }
      });
    });
  });
</script>
